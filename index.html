<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>BIOHACKER // NEURAL INTERFACE v9.4</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        :root { --red: #ff003c; --blue: #00f3ff; --green: #39ff14; --glass: rgba(15, 15, 20, 0.98); }
        body { background: #000; color: #e0e0e0; font-family: -apple-system, sans-serif; margin: 0; padding: 15px; display: flex; flex-direction: column; gap: 15px; padding-bottom: 40px; }
        .glass-panel { background: var(--glass); border: 1px solid #333; padding: 20px; border-radius: 15px; }
        h2 { color: var(--red); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 2px; margin: 0 0 15px 0; border-bottom: 1px solid #333; padding-bottom: 8px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px; }
        label { display: block; font-size: 0.6rem; color: #888; margin-bottom: 4px; text-transform: uppercase; }
        select, input { width: 100%; background: #111; border: 1px solid #444; color: #fff; padding: 12px; border-radius: 10px; font-size: 1rem; box-sizing: border-box; }
        .btn-add { width: 100%; background: var(--red); color: #fff; border: none; padding: 18px; border-radius: 12px; font-weight: bold; text-transform: uppercase; }
        .admin-card { background: #111; border-radius: 15px; padding: 18px; border: 1px solid #222; position: relative; border-left: 4px solid var(--red); margin-bottom: 15px; }
        .btn-del { position: absolute; top: 12px; right: 12px; color: #444; font-size: 1.2rem; border: none; background: none; }
        
        /* Jeringa Dinámica */
        .syringe-row { display: flex; align-items: center; gap: 20px; margin: 15px 0; }
        .syringe-body { width: 40px; border: 2px solid #fff; position: relative; border-radius: 0 0 6px 6px; background: rgba(255,255,255,0.05); transition: all 0.3s ease; }
        .fluid { position: absolute; bottom: 0; width: 100%; display: flex; align-items: center; justify-content: center; font-size: 0.55rem; color: #000; font-weight: bold; overflow: hidden; transition: height 0.3s; }
        .syringe-label { position: absolute; right: -45px; font-size: 0.5rem; color: var(--blue); }

        .check-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-top: 15px; }
        .day-btn { aspect-ratio: 1; background: #1a1a1a; border: 1px solid #333; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1rem; font-weight: bold; color: #444; }
        .day-btn.active { background: var(--red); color: white; border-color: var(--red); box-shadow: 0 0 12px var(--red); }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="glass-panel">
    <h2>Estructura del Ciclo</h2>
    <div class="form-row">
        <div>
            <label>Tipo</label>
            <select id="type" onchange="updateUI()">
                <option value="aceite">Aceite (Semanal)</option>
                <option value="peptido">Péptido (Diario)</option>
                <option value="hormona">HGH (Diario)</option>
                <option value="oral">Oral (Diario)</option>
            </select>
        </div>
        <div>
            <label>Sustancia</label>
            <select id="comp-name"></select>
        </div>
    </div>

    <div class="form-row">
        <div id="col-dose">
            <label id="label-dose">Total Semanal (mg)</label>
            <input type="number" id="input_val" value="500">
        </div>
        <div id="col-freq">
            <label>Inyecciones/Semana</label>
            <select id="freq">
                <option value="7">ED (Diario)</option>
                <option value="3.5">EOD (Día sí/no)</option>
                <option value="2" selected>2 veces/sem</option>
                <option value="1">1 vez/sem</option>
            </select>
        </div>
    </div>

    <div class="form-row">
        <div id="col-oil-conc">
            <label>Concentración (mg/ml)</label>
            <input type="number" id="oil_conc" value="250">
        </div>
        <div id="col-pept-dil" class="hidden">
            <label>mg vial / ml agua</label>
            <div style="display:flex; gap:5px">
                <input type="number" id="v_mg" value="5"><input type="number" id="v_ml" value="2">
            </div>
        </div>
    </div>

    <button class="btn-add" onclick="addItem()">Inyectar en Dashboard</button>
</div>

<div id="main-container"></div>

<script>
    let protocol = [];
    const db = {
        aceite: [{n: 'Testo Cipio', hl: 8}, {n: 'Testo Enant', hl: 7}, {n: 'DHB Cipio', hl: 8}, {n: 'Primo', hl: 10}, {n: 'Masteron', hl: 6}, {n: 'Tren E', hl: 8}],
        peptido: [{n: 'BPC-157', hl: 0.2}, {n: 'TB-500', hl: 120}, {n: 'GHK-Cu', hl: 0.5}],
        hormona: [{n: 'HGH Genotropin', hl: 0.15}, {n: 'HGH Humatrope', hl: 0.15}],
        oral: [{n: 'Oxandrolona', hl: 0.4}, {n: 'Winstrol', hl: 1}, {n: 'Anadrol', hl: 0.6}]
    };

    function updateUI() {
        const t = document.getElementById('type').value;
        document.getElementById('comp-name').innerHTML = db[t].map(c => `<option value="${c.n}">${c.n}</option>`).join('');
        const isWeekly = t === 'aceite';
        document.getElementById('label-dose').innerText = isWeekly ? 'Total Semanal (mg)' : (t === 'peptido' ? 'Dosis Diaria (mcg)' : (t === 'hormona' ? 'Dosis Diaria (UI)' : 'Dosis Diaria (mg)'));
        document.getElementById('col-freq').classList.toggle('hidden', !isWeekly);
        document.getElementById('col-oil-conc').classList.toggle('hidden', t === 'peptido' || t === 'hormona');
        document.getElementById('col-pept-dil').classList.toggle('hidden', t !== 'peptido');
    }

    function addItem() {
        const t = document.getElementById('type').value;
        const name = document.getElementById('comp-name').value;
        const val = parseFloat(document.getElementById('input_val').value);
        const info = db[t].find(c => c.n === name);
        let dosePerShot = val;
        let mlPerShot = 0;

        if (t === 'aceite') {
            const freq = parseFloat(document.getElementById('freq').value);
            const conc = parseFloat(document.getElementById('oil_conc').value);
            dosePerShot = val / freq;
            mlPerShot = dosePerShot / conc;
        } else if (t === 'peptido') {
            mlPerShot = (val / 1000) * (parseFloat(document.getElementById('v_ml').value) / parseFloat(document.getElementById('v_mg').value));
        } else if (t === 'hormona') {
            mlPerShot = val * 0.1;
        } else if (t === 'oral') {
            dosePerShot = val; // Dosis diaria
            mlPerShot = 0; // No usa jeringa física
        }

        protocol.push({
            id: Date.now(), type: t, name, dosePerShot, mlPerShot,
            unit: t === 'peptido' ? 'mcg' : (t === 'hormona' ? 'UI' : 'mg'),
            checks: new Array(31).fill(false), color: `hsl(${Math.random()*360}, 70%, 50%)`
        });
        render();
    }

    function render() {
        const container = document.getElementById('main-container');
        container.innerHTML = "";
        const aceites = protocol.filter(i => i.type === 'aceite');
        const otros = protocol.filter(i => i.type !== 'aceite');

        if(aceites.length > 0) renderCard(container, "JERINGA ACEITES (Mezcla)", aceites, true);
        otros.forEach(i => renderCard(container, i.name, [i], false));
    }

    function renderCard(container, title, items, isOil) {
        const totalMl = items.reduce((s, i) => s + i.mlPerShot, 0);
        const isOral = items[0].type === 'oral';
        
        // LOGICA DE JERINGA DINAMICA
        let syringeCap = 1.0; 
        let syringeHeight = 180;
        if (totalMl > 0 && totalMl <= 0.3) { syringeCap = 0.3; syringeHeight = 120; }
        else if (totalMl > 0.3 && totalMl <= 0.5) { syringeCap = 0.5; syringeHeight = 150; }
        else { syringeCap = Math.max(1.0, Math.ceil(totalMl)); syringeHeight = 200; }

        const card = document.createElement('div');
        card.className = 'admin-card';
        const refItem = items[0];

        card.innerHTML = `
            <button class="btn-del" onclick="removeItem(${refItem.id})">✖</button>
            <h2 style="color:var(--blue); border:none; margin:0; font-size:0.7rem">${title}</h2>
            
            <div class="syringe-row ${isOral ? 'hidden' : ''}">
                <div class="syringe-body" style="height: ${syringeHeight}px">
                    ${items.map((i, idx) => {
                        const h = (i.mlPerShot / syringeCap) * syringeHeight;
                        const bot = items.slice(0,idx).reduce((s,c)=>(s+(c.mlPerShot/syringeCap)*syringeHeight),0);
                        return `<div class="fluid" style="height:${h}px; bottom:${bot}px; background:${i.color}">${i.mlPerShot.toFixed(2)}</div>`;
                    }).join('')}
                    <div class="syringe-label" style="top:0">-${syringeCap}ml</div>
                    <div class="syringe-label" style="bottom:0">-0ml</div>
                </div>
                <div style="flex:1">
                    <div style="font-size:1.6rem; font-weight:bold; color:var(--green)">${totalMl.toFixed(2)} ml</div>
                    ${items.map(i => `<div style="font-size:0.75rem; margin-top:3px">• ${i.name}: ${i.dosePerShot.toFixed(1)}${i.unit}</div>`).join('')}
                </div>
            </div>

            <div class="${isOral ? '' : 'hidden'}">
                <div style="font-size:1.6rem; font-weight:bold; color:var(--blue)">${refItem.dosePerShot} ${refItem.unit} <small style="font-size:0.8rem">DIARIOS</small></div>
            </div>

            <div class="check-grid">
                ${refItem.checks.map((c, idx) => `<div class="day-btn ${c ? 'active' : ''}" onclick="toggleCheck(${refItem.id}, ${idx})">${idx+1}</div>`).join('')}
            </div>
        `;
        container.appendChild(card);
    }

    function toggleCheck(id, day) {
        const item = protocol.find(i => i.id === id);
        if (item.type === 'aceite') protocol.filter(i => i.type === 'aceite').forEach(i => i.checks[day] = !i.checks[day]);
        else item.checks[day] = !item.checks[day];
        if(navigator.vibrate) navigator.vibrate(50);
        render();
    }

    function removeItem(id) { protocol = protocol.filter(i => i.id !== id); render(); }
    updateUI();
</script>
</body>
</html>
